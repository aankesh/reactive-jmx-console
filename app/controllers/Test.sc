/**
 * Created with IntelliJ IDEA.
 * User: ahenrick
 * Date: 10/9/13
 * Time: 3:35 PM
 * To change this template use File | Settings | File Templates.
 */


import fr.janalyse.jmx.{RichAttribute, RichMBean}
import jajmx._
import play.api.libs.json._
import play.api.libs.functional.syntax._

val jmx = JMX()
val domains = jmx.domains


val attrWrites = new Writes[RichAttribute] {
  def writes(attr: RichAttribute) = Json.obj(
    "name" -> Json.toJson(attr.name) ,
    "description" -> Json.toJson(attr.desc)
  )
}


val mbeanWrites = new Writes[RichMBean] {
  def writes(m: RichMBean) = Json.obj(
    "name" -> Json.toJson(m.name),
    "domain" -> Json.toJson(m.domain),
    "attributes" -> Json.arr(m.attributes().map(attr => Json.toJson(attr)(attrWrites)))
  )
}

//val mbeans = Json.toJson(jmx.mbeans().map(m => Json.toJson(m)(mbeanWrites)))
val result = Json.toJson(jmx.mbeans().groupBy(m => m.domain).map(y => Json.obj("domain" -> y._1 ,
  "mbeans" -> y._2.map(x => Json.toJson(x)(mbeanWrites)).toSeq)))



jmx.mbeans().map(m => m.mbeanInfo.getOperations)







//val json = Json.toJson(mbeans).map()
/*for {
  domain <- jmx.domains
  mbean <- jmx.mbeans(domain + ":*")
  attr  <- mbean.attributes
  value <- mbean.getString(attr)
} {
  println(s"${mbean.name} - ${attr.name} = ${value}")
  println("*******************************************")
}*/































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































